<?php

/*
 * @file
 * Use this file as a php scratchpad for your Drupal site. You might want to
 * load a node, change it, and call node_save($node), for example. If you have
 * used the Execute PHP feature of devel.module, this is the drush equivalent.
 * 
 * You may edit this file with whatever php you choose. Then execute the file
 * using `drush script scratch.php`. That command will bootstrap your drupal
 * site and then run the php below.
 * 
 * The script command enables to store your script files wherever you wish and
 * will help you list all of them should you collection grow. See its help.
 *
 */

// Just some ideas to get the juices flowing.
//drush_print_r(menu_get_item());
//drush_print_r(user_roles());
//drush_print_r($GLOBALS['user']);
  $query_by_state="
        SELECT profile.field_state_value AS state_name, COUNT(node.nid) AS population
        FROM node
        LEFT JOIN content_type_profile profile ON node.vid = profile.vid
        INNER JOIN users_roles ON node.uid = users_roles.uid
        WHERE profile.field_member_type_value = 'Participant'
           AND users_roles.rid = 16
        GROUP BY state_name
        ORDER BY state_name ASC";
  $results = db_query($query_by_state);
  if(!$results) die("Error: _fsp_stats_by_state query");
  $state_stats = array();
  while ($stat = db_fetch_object($results)) {
    if (strlen($stat->state_name) < 1) {
      $state_stats["None"] = $stat->population;
    }
    else {
      $state_stats[$stat->state_name] = $stat->population;
    }
  }
  die(print_r($state_stats,TRUE));
